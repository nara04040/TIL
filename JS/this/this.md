# this

다른 객체지향 언어에서의 this는 "클래스로 생성한 인스턴스 객체를 의미한다."

그러나 자바스크립트에서 this는 **어디서든 사용이 가능하다**

상황에 따라 this가 바라보는 대상이 달라진다. 고로 정확한 작동 방식을 이해하지 못하면 원인이 무엇인지 모른다.

함수와 객체의 구분이 느슨한 자바스크립트에서 this는 실질적으로 둘을 구분하는 유일한 기능이다.

<br>
<br>

## 상황에 따라 달라지는 this

<br>

자바스크립트에서 this는 기본적으로 실행 컨텍스트가 생성될 때 함께 결정된다.

실행컨텍스트는 함수를 호출할 때 생성된다. 이 말은 this는 **함수를 호출할 때 결정된다.**

### 전역공간에서의 this

전역에서의 this는 당연히 전역 객체를 가르킨다.

이때 전역객체는 자바스크립트의 런타임 환경에 따라 다른 이름과 정보를 가지고있는데,

브라우저 환경에서의 전역객체는 window,    Node.js 환경에서는 global이다.

<br>

 >  다른 소리를 하나 빠지자면 , 전역변수를 선언하면 자바스크립트 엔진은 전역객체의 프로퍼티로 할당이 가능, 즉 변수이면서 객체의 프로퍼티이기도 하다!

<br>

위 말을 코드로 바꾼다면 

<br>

```javascript
var a = 1;
console.log(a) // 1
console.log(window.a) // 1
console.log(this.a) // 1
```

<br>

전역공간에서 선언한 변수 a에 1을 할당했지만 window.a와 this.a 모두 1이 출력된다.

전역공간에서 this는 전역객체를 의미하므로 두 값이 같은것은 당연하지만 값이 1 인것은 이상하다.

> 이 이유는 **자바스크립트의 모든 변수는 실은 특정 객체의 프로퍼티로** 동작하기 때문이다.

<br>

사용자가 var 연산자를 사용해 변수를 선언하더라도 실제 자바스크립트 엔진은 특정 객체의 프로퍼티로 인식한다.

이때 특정 객체는 실행컨텍스트의 LexicalEnvironment이다.

실행컨텍스트는 변수를 수집하고 L.E의 프로퍼티로 저장한다.

이후 어떤 변수를 호출하면 L.E를 조회하여 일치한다면 값을 반환한다.

즉 앞에서 **"전역변수를 선언하면 자동으로 전역객체의 프로퍼티로 할당한다"** 이말은 정확하지 않다.

> 정확한 표현은 **전역변수를 선언하면 자바스크립트 엔진은 이를 전역객체의 프로퍼티로 할당한다.** 가 맞는 말이다.

<br>

또 다른 문제는 a라는 변수를 직접 호출할 때에도 1이 출력된다.

이 이유는 변수 a에 접근하고자 하면 스코프 체인에서 a를 검색하다  가장 마지막에 도달하는 전역 스코프까지 올라가 L.E , 전역객체에서 해당 프로퍼티 a를 발견하여 반환하기 때문이다.

<br>

위 말을 인용하면 var로 변수를 선언하는 대신 window의 프로퍼티에 직접 할당하더라도 결과적으로 var로 선언한 것과 똑같이 동작한다 라는 예상을 할 수 있다.

하지만 전역변수 선언과 전역객체의 프로퍼티 할당 사이에 다른경우가 존재한다.

> 바로 "삭제"명령이다.

<br>

```javascript
var a =1;
delete window.a;    // false
console.log(a, window.a, this.a);   // 1 1 1
```
```javascript
var b =2;
delete b;    // false
console.log(b, window.b, this.b);   // 2 2 2
```

```javascript
window.c =3;
delete window.c;    // true
console.log(c, window.c, this.c);   // Uncaught ReferenceError : c is not defined
```

```javascript
window.d = 4;
delete d;    // true
console.log(d, window.d, this.d);   // Uncaught ReferenceError : d is not defined
```

위 코드를 본다면 전역객체의 프로퍼티로 할당한다면 삭제가되지만

전역변수로 선언한 경우는 삭제가 불가하다.

이는 사용자가 의도치 않게 삭제하는 것을 방지하는 차원에서 방어 전략이라고 해석한다.

즉 전역변수를 선언하면 자바스크립트 엔진은 이를 자동으로 전역객체의 프로퍼티로 할당하면서 configurable속성(변경 및 삭제 가능성)을 false로 정의한다.